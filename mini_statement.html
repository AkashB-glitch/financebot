<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini Statement - Maze Bank</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        .statement-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: rgba(0, 0, 0, 0.8);
            min-height: 100vh;
        }
        
        .statement-card {
            background: rgba(0, 245, 255, 0.1);
            border-radius: 15px;
            padding: 30px;
            border: 1px solid rgba(0, 245, 255, 0.2);
            margin-bottom: 20px;
        }
        
        .statement-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(0, 245, 255, 0.3);
        }
        
        .bank-logo {
            font-size: 2rem;
            color: #00f5ff;
            margin-bottom: 10px;
        }
        
        .account-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
        }
        
        .info-item {
            color: white;
        }
        
        .info-label {
            color: #00f5ff;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .transaction-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .summary-card {
            background: rgba(0, 0, 0, 0.5);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid rgba(0, 245, 255, 0.2);
        }
        
        .summary-icon {
            font-size: 2rem;
            color: #00f5ff;
            margin-bottom: 10px;
        }
        
        .summary-amount {
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
        }
        
        .summary-label {
            color: #ccc;
            font-size: 0.9rem;
        }
        
        .recent-transactions {
            margin-top: 20px;
        }
        
        .transaction-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .transaction-table th,
        .transaction-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid rgba(0, 245, 255, 0.2);
        }
        
        .transaction-table th {
            background: rgba(0, 245, 255, 0.2);
            color: #00f5ff;
            font-weight: bold;
        }
        
        .transaction-table td {
            color: white;
        }
        
        .credit {
            color: #4CAF50;
        }
        
        .debit {
            color: #f44336;
        }
        
        .print-button {
            background: linear-gradient(45deg, #00f5ff, #0080ff);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin-top: 20px;
            transition: all 0.3s ease;
        }
        
        .print-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 245, 255, 0.4);
        }
        
        @media print {
            .back-button, .print-button {
                display: none;
            }
            .statement-container {
                background: white;
                color: black;
            }
            .statement-card {
                background: white;
                border: 1px solid #ccc;
            }
        }
    </style>
</head>
<body>
    <div class="background"></div>
    
    <div class="statement-container">
        <a href="{{ url_for('home') }}" class="back-button">
            <i class="fas fa-arrow-left"></i>
            Back to Home
        </a>
        
        <div class="page-header">
            <h1><i class="fas fa-file-alt"></i> Bank Mini Statement</h1>
            <p>Quick overview of your recent account activity</p>
        </div>
        
        <div class="login-section">
            <h3 style="color: #00f5ff; margin-bottom: 20px;">Enter Your Credentials</h3>
            <form id="statementForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="accountNumber">Account Number:</label>
                        <input type="text" id="accountNumber" placeholder="Enter your account number" required>
                    </div>
                    <div class="form-group">
                        <label for="password">Password:</label>
                        <input type="password" id="password" placeholder="Enter your password" required>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-file-alt"></i> Generate Mini Statement
                </button>
            </form>
        </div>
        
        <div id="statementContent" style="display: none;">
            <!-- Statement content will be loaded here -->
        </div>
    </div>
    
    <script>
        document.getElementById('statementForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const accountNumber = document.getElementById('accountNumber').value;
            const password = document.getElementById('password').value;
            
            // Show loading
            document.getElementById('statementContent').style.display = 'block';
            document.getElementById('statementContent').innerHTML = `
                <div class="statement-card">
                    <div class="loading" style="text-align: center; color: #00f5ff; padding: 40px;">
                        <i class="fas fa-spinner fa-spin"></i> Generating mini statement...
                    </div>
                </div>
            `;
            
            try {
                const response = await fetch('/api/mini-statement', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        account_number: accountNumber,
                        password: password
                    })
                });
                
                const data = await response.json();
                
                if (data.status === 'success') {
                    displayMiniStatement(data);
                } else {
                    document.getElementById('statementContent').innerHTML = `
                        <div class="statement-card">
                            <div class="no-transactions" style="text-align: center; color: #ccc; padding: 40px;">
                                <i class="fas fa-exclamation-circle"></i><br>
                                Error: ${data.message}
                            </div>
                        </div>
                    `;
                }
            } catch (error) {
                document.getElementById('statementContent').innerHTML = `
                    <div class="statement-card">
                        <div class="no-transactions" style="text-align: center; color: #ccc; padding: 40px;">
                            <i class="fas fa-exclamation-triangle"></i><br>
                            Network error. Please try again.
                        </div>
                    </div>
                `;
            }
        });
        
        function displayMiniStatement(data) {
            const content = document.getElementById('statementContent');
            const currentDate = new Date().toLocaleDateString();
            
            let html = `
                <div class="statement-card">
                    <div class="statement-header">
                        <div class="bank-logo">
                            <i class="fas fa-university"></i> MAZE BANK
                        </div>
                        <h2 style="color: #00f5ff; margin: 0;">Mini Statement</h2>
                        <p style="color: white; margin: 5px 0;">Generated on: ${currentDate}</p>
                    </div>
                    
                    <div class="account-info">
                        <div class="info-item">
                            <div class="info-label">Account Holder</div>
                            <div>${data.user_name}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Account Number</div>
                            <div>${data.account_number}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Current Balance</div>
                            <div style="color: #4CAF50; font-weight: bold;">â‚¹${data.balance.toLocaleString()}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Statement Period</div>
                            <div>Last 10 transactions</div>
                        </div>
                    </div>
                    
                    <div class="transaction-summary">
                        <div class="summary-card">
                            <div class="summary-icon">
                                <i class="fas fa-arrow-down"></i>
                            </div>
                            <div class="summary-amount credit">â‚¹${data.total_credits.toLocaleString()}</div>
                            <div class="summary-label">Total Credits</div>
                        </div>
                        <div class="summary-card">
                            <div class="summary-icon">
                                <i class="fas fa-arrow-up"></i>
                            </div>
                            <div class="summary-amount debit">â‚¹${data.total_debits.toLocaleString()}</div>
                            <div class="summary-label">Total Debits</div>
                        </div>
                        <div class="summary-card">
                            <div class="summary-icon">
                                <i class="fas fa-list"></i>
                            </div>
                            <div class="summary-amount">${data.transaction_count}</div>
                            <div class="summary-label">Transactions</div>
                        </div>
                    </div>
                    
                    <div class="recent-transactions">
                        <h3 style="color: #00f5ff; margin-bottom: 15px;">
                            <i class="fas fa-history"></i> Recent Transactions
                        </h3>
            `;
            
            if (data.transactions.length > 0) {
                html += `
                    <table class="transaction-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Description</th>
                                <th>Amount</th>
                                <th>Type</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                data.transactions.forEach(transaction => {
                    const isCredit = transaction.type === 'credit';
                    const amountClass = isCredit ? 'credit' : 'debit';
                    const sign = isCredit ? '+' : '-';
                    
                    html += `
                        <tr>
                            <td>${new Date(transaction.date).toLocaleDateString()}</td>
                            <td>${transaction.description}</td>
                            <td class="${amountClass}">${sign}â‚¹${transaction.amount.toLocaleString()}</td>
                            <td>${transaction.type.toUpperCase()}</td>
                        </tr>
                    `;
                });
                
                html += `
                        </tbody>
                    </table>
                `;
            } else {
                html += `
                    <div style="text-align: center; color: #ccc; padding: 20px;">
                        <i class="fas fa-inbox"></i><br>
                        No recent transactions found
                    </div>
                `;
            }
            
            html += `
                    </div>
                    
                    <button class="print-button" onclick="window.print()">
                        <i class="fas fa-print"></i> Print Statement
                    </button>
                </div>
            `;
            
            content.innerHTML = html;
        }
    </script>
</body>
</html>
