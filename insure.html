<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Insurance - Maze Bank</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .navbar {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            color: white;
        }

        .navbar nav a {
            color: white;
            text-decoration: none;
            margin: 0 1rem;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            transition: background 0.3s;
        }

        .navbar nav a:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        .page-header {
            text-align: center;
            margin-bottom: 3rem;
            color: white;
        }

        .page-header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .page-header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .insurance-types {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .insurance-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
            border: 3px solid transparent;
        }

        .insurance-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        }

        .insurance-card.selected {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }

        .insurance-icon {
            font-size: 3rem;
            color: #667eea;
            text-align: center;
            margin-bottom: 1rem;
        }

        .insurance-card h3 {
            font-size: 1.5rem;
            color: #333;
            text-align: center;
            margin-bottom: 1rem;
        }

        .insurance-card p {
            color: #666;
            text-align: center;
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .insurance-features {
            list-style: none;
            padding: 0;
        }

        .insurance-features li {
            color: #555;
            margin-bottom: 0.5rem;
            padding-left: 1.5rem;
            position: relative;
        }

        .insurance-features li:before {
            content: "âœ“";
            color: #667eea;
            font-weight: bold;
            position: absolute;
            left: 0;
        }

        .application-form {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            display: none;
            margin-bottom: 2rem;
        }

        .application-form.show {
            display: block;
        }

        .form-section {
            margin-bottom: 2rem;
        }

        .form-section h3 {
            color: #667eea;
            margin-bottom: 1rem;
            font-size: 1.3rem;
            border-bottom: 2px solid #667eea;
            padding-bottom: 0.5rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
            color: #333;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            width: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: #6c757d;
            margin-top: 1rem;
        }

        .btn-secondary:hover {
            box-shadow: 0 10px 20px rgba(108, 117, 125, 0.3);
        }

        .quote-display {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            display: none;
            margin-bottom: 2rem;
        }

        .quote-display.show {
            display: block;
        }

        .quote-item {
            display: flex;
            justify-content: space-between;
            padding: 0.8rem 0;
            border-bottom: 1px solid #eee;
        }

        .quote-item:last-child {
            border-bottom: none;
        }

        .quote-label {
            font-weight: bold;
            color: #333;
        }

        .quote-value {
            color: #667eea;
            font-weight: bold;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 1rem;
            border-radius: 8px;
            margin-top: 1rem;
            border: 1px solid #c3e6cb;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 1rem;
            border-radius: 8px;
            margin-top: 1rem;
            border: 1px solid #f5c6cb;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .insurance-types {
                grid-template-columns: 1fr;
            }
            
            .navbar {
                flex-direction: column;
                gap: 1rem;
            }
            
            .container {
                padding: 0 0.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <header class="navbar">
        <div class="logo">Maze Bank</div>
        <nav>
            <a href="{{ url_for('home') }}">Home</a>
            <a href="{{ url_for('save_page') }}">Save</a>
            <a href="{{ url_for('pay_page') }}">Pay</a>
            <a href="{{ url_for('invest_page') }}">Invest</a>
            <a href="{{ url_for('borrow_page') }}">Borrow</a>
            <a href="{{ url_for('insure_page') }}">Insure</a>
            <a href="{{ url_for('offers_page') }}">Offers</a>
        </nav>
    </header>

    <div class="container">
        <div class="page-header">
            <h1><i class="fas fa-shield-alt"></i> Insurance Plans</h1>
            <p>Protect yourself and your loved ones with our comprehensive insurance coverage</p>
        </div>

        <!-- Insurance Types Selection -->
        <div class="insurance-types" id="insuranceTypes">
            <!-- Insurance cards will be populated by JavaScript -->
        </div>

        <!-- Application Form -->
        <div class="application-form" id="applicationForm">
            <h3><i class="fas fa-file-alt"></i> Insurance Application</h3>
            <form id="insuranceForm">
                <!-- Form content will be populated by JavaScript -->
            </form>
        </div>

        <!-- Quote Display -->
        <div class="quote-display" id="quoteDisplay">
            <h3><i class="fas fa-calculator"></i> Insurance Quote</h3>
            <div id="quoteContent"></div>
            <button type="button" class="btn" id="purchaseBtn">
                <i class="fas fa-shopping-cart"></i> Purchase Insurance
            </button>
        </div>

        <!-- Messages -->
        <div id="messageContainer"></div>
    </div>

    <script>
        // Insurance types data
        const insuranceTypes = {
            life: {
                title: "Life Insurance",
                icon: "fas fa-heartbeat",
                description: "Secure your family's financial future with comprehensive life coverage",
                features: [
                    "Death benefit coverage",
                    "Tax benefits under 80C",
                    "Flexible premium payment",
                    "Loan facility available",
                    "Maturity benefits"
                ],
                baseRate: 0.5, // % of sum assured per year
                maxCoverage: 10000000
            },
            health: {
                title: "Health Insurance",
                icon: "fas fa-user-md",
                description: "Complete healthcare protection for you and your family",
                features: [
                    "Cashless hospitalization",
                    "Pre & post hospitalization",
                    "Day care procedures",
                    "Ambulance charges",
                    "Annual health checkup"
                ],
                baseRate: 0.8,
                maxCoverage: 2500000
            },
            accident: {
                title: "Accident Insurance",
                icon: "fas fa-ambulance",
                description: "Protection against unforeseen accidents and disabilities",
                features: [
                    "Accidental death benefit",
                    "Permanent disability cover",
                    "Temporary disability benefit",
                    "Medical expense coverage",
                    "24/7 emergency assistance"
                ],
                baseRate: 0.3,
                maxCoverage: 5000000
            },
            vehicle: {
                title: "Vehicle Insurance",
                icon: "fas fa-car",
                description: "Comprehensive protection for your vehicle",
                features: [
                    "Third party liability",
                    "Own damage coverage",
                    "Theft protection",
                    "Natural calamity cover",
                    "Roadside assistance"
                ],
                baseRate: 2.5,
                maxCoverage: 2000000
            },
            home: {
                title: "Home Insurance",
                icon: "fas fa-home",
                description: "Protect your home and belongings from various risks",
                features: [
                    "Structure damage cover",
                    "Contents insurance",
                    "Theft protection",
                    "Natural disaster cover",
                    "Temporary accommodation"
                ],
                baseRate: 0.4,
                maxCoverage: 5000000
            }
        };

        let selectedInsurance = null;

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            renderInsuranceTypes();
        });

        function renderInsuranceTypes() {
            const container = document.getElementById('insuranceTypes');
            container.innerHTML = '';

            Object.keys(insuranceTypes).forEach(key => {
                const insurance = insuranceTypes[key];
                const card = document.createElement('div');
                card.className = 'insurance-card';
                card.onclick = () => selectInsurance(key);

                card.innerHTML = `
                    <div class="insurance-icon">
                        <i class="${insurance.icon}"></i>
                    </div>
                    <h3>${insurance.title}</h3>
                    <p>${insurance.description}</p>
                    <ul class="insurance-features">
                        ${insurance.features.map(feature => `<li>${feature}</li>`).join('')}
                    </ul>
                `;

                container.appendChild(card);
            });
        }

        function selectInsurance(type) {
            selectedInsurance = type;

            // Update card selection
            document.querySelectorAll('.insurance-card').forEach(card => {
                card.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');

            // Show application form
            showApplicationForm(type);
        }

        function showApplicationForm(type) {
            const insurance = insuranceTypes[type];
            const form = document.getElementById('applicationForm');
            const formElement = document.getElementById('insuranceForm');

            let specificFields = '';

            // Add type-specific fields
            switch(type) {
                case 'life':
                    specificFields = `
                        <div class="form-group">
                            <label for="nomineeName">Nominee Name *</label>
                            <input type="text" id="nomineeName" name="nomineeName" required>
                        </div>
                        <div class="form-group">
                            <label for="nomineeRelation">Nominee Relationship *</label>
                            <select id="nomineeRelation" name="nomineeRelation" required>
                                <option value="">Select relationship</option>
                                <option value="spouse">Spouse</option>
                                <option value="child">Child</option>
                                <option value="parent">Parent</option>
                                <option value="sibling">Sibling</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                    `;
                    break;
                case 'health':
                    specificFields = `
                        <div class="form-group">
                            <label for="familyMembers">Number of Family Members *</label>
                            <select id="familyMembers" name="familyMembers" required>
                                <option value="">Select members</option>
                                <option value="1">Individual</option>
                                <option value="2">2 Members</option>
                                <option value="3">3 Members</option>
                                <option value="4">4 Members</option>
                                <option value="5+">5+ Members</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="medicalHistory">Any Pre-existing Medical Conditions?</label>
                            <textarea id="medicalHistory" name="medicalHistory" rows="3" placeholder="Please mention any existing health conditions"></textarea>
                        </div>
                    `;
                    break;
                case 'vehicle':
                    specificFields = `
                        <div class="form-row">
                            <div class="form-group">
                                <label for="vehicleType">Vehicle Type *</label>
                                <select id="vehicleType" name="vehicleType" required>
                                    <option value="">Select type</option>
                                    <option value="car">Car</option>
                                    <option value="bike">Motorcycle</option>
                                    <option value="truck">Truck</option>
                                    <option value="bus">Bus</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="vehicleYear">Manufacturing Year *</label>
                                <input type="number" id="vehicleYear" name="vehicleYear" min="1990" max="2024" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="registrationNumber">Registration Number *</label>
                            <input type="text" id="registrationNumber" name="registrationNumber" required placeholder="e.g., MH01AB1234">
                        </div>
                    `;
                    break;
                case 'home':
                    specificFields = `
                        <div class="form-row">
                            <div class="form-group">
                                <label for="propertyType">Property Type *</label>
                                <select id="propertyType" name="propertyType" required>
                                    <option value="">Select type</option>
                                    <option value="apartment">Apartment</option>
                                    <option value="house">Independent House</option>
                                    <option value="villa">Villa</option>
                                    <option value="commercial">Commercial</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="propertyAge">Property Age (years) *</label>
                                <input type="number" id="propertyAge" name="propertyAge" min="0" max="100" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="propertyAddress">Property Address *</label>
                            <textarea id="propertyAddress" name="propertyAddress" rows="3" required placeholder="Complete property address"></textarea>
                        </div>
                    `;
                    break;
                case 'accident':
                    specificFields = `
                        <div class="form-group">
                            <label for="occupation">Occupation *</label>
                            <input type="text" id="occupation" name="occupation" required placeholder="Your current occupation">
                        </div>
                        <div class="form-group">
                            <label for="riskLevel">Risk Level of Occupation *</label>
                            <select id="riskLevel" name="riskLevel" required>
                                <option value="">Select risk level</option>
                                <option value="low">Low Risk (Office work, etc.)</option>
                                <option value="medium">Medium Risk (Field work, etc.)</option>
                                <option value="high">High Risk (Construction, etc.)</option>
                            </select>
                        </div>
                    `;
                    break;
            }

            formElement.innerHTML = `
                <div class="form-section">
                    <h3><i class="fas fa-user"></i> Personal Information</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="accountNumber">Account Number *</label>
                            <input type="text" id="accountNumber" name="accountNumber" required placeholder="Enter your account number">
                        </div>
                        <div class="form-group">
                            <label for="password">Password *</label>
                            <input type="password" id="password" name="password" required placeholder="Enter your password">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="fullName">Full Name *</label>
                            <input type="text" id="fullName" name="fullName" required placeholder="Enter your full name">
                        </div>
                        <div class="form-group">
                            <label for="dateOfBirth">Date of Birth *</label>
                            <input type="date" id="dateOfBirth" name="dateOfBirth" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="phoneNumber">Phone Number *</label>
                            <input type="tel" id="phoneNumber" name="phoneNumber" required placeholder="Enter your phone number">
                        </div>
                        <div class="form-group">
                            <label for="email">Email Address *</label>
                            <input type="email" id="email" name="email" required placeholder="Enter your email">
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3><i class="fas fa-shield-alt"></i> ${insurance.title} Details</h3>
                    <div class="form-group">
                        <label for="coverageAmount">Coverage Amount (â‚¹) *</label>
                        <input type="number" id="coverageAmount" name="coverageAmount" required
                               min="100000" max="${insurance.maxCoverage}"
                               placeholder="Enter desired coverage amount">
                        <small>Maximum coverage: â‚¹${insurance.maxCoverage.toLocaleString()}</small>
                    </div>
                    ${specificFields}
                </div>

                <button type="submit" class="btn" id="submitBtn">
                    <i class="fas fa-calculator"></i> Get Quote
                </button>
                <button type="button" class="btn btn-secondary" onclick="hideApplicationForm()">
                    <i class="fas fa-arrow-left"></i> Back to Insurance Types
                </button>
            `;

            form.classList.add('show');
            form.scrollIntoView({ behavior: 'smooth' });

            // Add form submit handler
            formElement.addEventListener('submit', handleFormSubmit);
        }

        function hideApplicationForm() {
            document.getElementById('applicationForm').classList.remove('show');
            document.getElementById('quoteDisplay').classList.remove('show');
            document.querySelectorAll('.insurance-card').forEach(card => {
                card.classList.remove('selected');
            });
            selectedInsurance = null;
        }

        async function handleFormSubmit(e) {
            e.preventDefault();

            const submitBtn = document.getElementById('submitBtn');
            const messageContainer = document.getElementById('messageContainer');

            // Disable submit button and show loading
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Calculating Quote...';

            // Clear previous messages
            messageContainer.innerHTML = '';

            // Get form data
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData);
            data.insuranceType = selectedInsurance;

            try {
                const response = await fetch('/api/get_insurance_quote', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();

                if (result.status === 'success') {
                    showQuote(result.quote);
                    showMessage('Quote calculated successfully!', 'success');
                } else {
                    showMessage(result.message || 'Error calculating quote', 'error');
                }
            } catch (error) {
                showMessage('Network error. Please try again.', 'error');
            }

            resetSubmitButton();
        }

        function showQuote(quote) {
            const content = document.getElementById('quoteContent');
            content.innerHTML = `
                <div class="quote-item">
                    <span class="quote-label">Insurance Type:</span>
                    <span class="quote-value">${quote.type}</span>
                </div>
                <div class="quote-item">
                    <span class="quote-label">Coverage Amount:</span>
                    <span class="quote-value">â‚¹${quote.coverage_amount.toLocaleString()}</span>
                </div>
                <div class="quote-item">
                    <span class="quote-label">Annual Premium:</span>
                    <span class="quote-value">â‚¹${quote.annual_premium.toLocaleString()}</span>
                </div>
                <div class="quote-item">
                    <span class="quote-label">Monthly Premium:</span>
                    <span class="quote-value">â‚¹${quote.monthly_premium.toLocaleString()}</span>
                </div>
                <div class="quote-item">
                    <span class="quote-label">Policy Term:</span>
                    <span class="quote-value">${quote.policy_term} years</span>
                </div>
                <div class="quote-item">
                    <span class="quote-label">Total Premium (${quote.policy_term} years):</span>
                    <span class="quote-value">â‚¹${quote.total_premium.toLocaleString()}</span>
                </div>
            `;

            document.getElementById('quoteDisplay').classList.add('show');
            document.getElementById('quoteDisplay').scrollIntoView({ behavior: 'smooth' });
        }

        // Purchase insurance handler
        document.getElementById('purchaseBtn').addEventListener('click', async function() {
            const btn = this;
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing Purchase...';

            try {
                const response = await fetch('/api/purchase_insurance', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        account_number: document.getElementById('accountNumber').value,
                        password: document.getElementById('password').value,
                        insurance_type: selectedInsurance
                    })
                });

                const result = await response.json();

                if (result.status === 'success') {
                    showMessage(`Insurance purchased successfully! Policy Number: ${result.policy_number}. Premium amount â‚¹${result.premium_amount} has been deducted from your account.`, 'success');
                    hideApplicationForm();
                } else {
                    showMessage(result.message || 'Error purchasing insurance', 'error');
                }
            } catch (error) {
                showMessage('Network error. Please try again.', 'error');
            }

            btn.disabled = false;
            btn.innerHTML = '<i class="fas fa-shopping-cart"></i> Purchase Insurance';
        });

        function showMessage(message, type) {
            const messageContainer = document.getElementById('messageContainer');
            const messageClass = type === 'success' ? 'success-message' : 'error-message';
            messageContainer.innerHTML = `<div class="${messageClass}">${message}</div>`;
        }

        function resetSubmitButton() {
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = false;
            submitBtn.innerHTML = '<i class="fas fa-calculator"></i> Get Quote';
        }
    </script>
</body>
</html>
